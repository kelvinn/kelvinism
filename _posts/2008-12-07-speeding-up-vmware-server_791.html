---
layout: post
title: Speeding Up VMWare Server
date: '2008-12-07T21:30:00.008+11:00'
author: Kelvin Nicholson
tags:
- vmware
- articles
- performance
- tips and tricks
modified_time: '2013-01-09T20:49:06.777+11:00'
blogger_id: tag:blogger.com,1999:blog-3439832858234004835.post-6458598623725084667
blogger_orig_url: https://www.kelvinism.com/2008/12/speeding-up-vmware-server_791.html
---

<p>I found VMWare Server to have very slow I/O, and sought to improve it.  Below are a list of tests I performed, the change, and the results.</p><pre class="brush: plain; light: true; "><br /><br />### Host OS ###<br />/dev/sdb1:<br /> Timing buffered disk reads:  220 MB in  3.05 seconds =  72.17 MB/sec<br />kelvin@gorilla:~$ sudo hdparm -t /dev/sdb1<br /><br />/dev/sdb1:<br /> Timing buffered disk reads:  266 MB in  3.01 seconds =  88.33 MB/sec<br />kelvin@gorilla:~$ sudo hdparm -t /dev/sdb1<br /><br />/dev/sdb1:<br /> Timing buffered disk reads:  310 MB in  3.01 seconds = 102.99 MB/sec<br /><br /><br />### Before Changes ###<br /><br />/dev/mapper/openfiler-data:<br /> Timing buffered disk reads:    8 MB in  3.36 seconds =   2.38 MB/sec<br />[root@files etc]# hdparm -t /dev/mapper/openfiler-data<br /><br />/dev/mapper/openfiler-data:<br /> Timing buffered disk reads:   24 MB in  3.63 seconds =   6.61 MB/sec<br />[root@files etc]# hdparm -t /dev/mapper/openfiler-data<br /><br />/dev/mapper/openfiler-data:<br /> Timing buffered disk reads:   28 MB in  4.54 seconds =   6.16 MB/sec<br /><br /></pre><br /><br /><p>I made several changes, but the changes that seemed to have the most impact are below:</p><pre class="brush: plain; light: true; "><br /><br />vm.dirty_background_ratio = 5<br />vm.dirty_ratio = 10<br />vm.swappiness = 0<br /><br /></pre><br /><p>Pop this into the virtual machine's .vmx file, reboot, and off you go.  One unfortunate side effect is that you can no longer overload the memory (e.g. allocate more memory with the VMs than you actually have available).</p><pre class="brush: plain; light: true; "><br /><br />### After Changes ###<br /><br />/dev/mapper/openfiler-data:<br /> Timing buffered disk reads:   52 MB in  3.13 seconds =  16.61 MB/sec<br />[root@files ~]# hdparm -t /dev/mapper/openfiler-data<br /><br />/dev/mapper/openfiler-data:<br /> Timing buffered disk reads:   82 MB in  3.31 seconds =  24.75 MB/sec<br />[root@files ~]# hdparm -t /dev/mapper/openfiler-data<br /><br />/dev/mapper/openfiler-data:<br /> Timing buffered disk reads:  118 MB in  3.19 seconds =  36.97 MB/sec<br />[root@files ~]# hdparm -t /dev/mapper/openfiler-data<br /><br />/dev/mapper/openfiler-data:<br /> Timing buffered disk reads:  144 MB in  3.32 seconds =  43.37 MB/sec<br /><br />[root@files ~]# hdparm -t /dev/mapper/openfiler-data<br /><br />/dev/mapper/openfiler-data:<br /> Timing buffered disk reads:  160 MB in  3.10 seconds =  51.57 MB/sec<br /><br /><br /></pre><br /><br /><p><b>UPDATE</b>: Those wanting all the speed and still want to use memory overloading, I'd suggested you give ESXi a try.  So far, so good.</p><pre class="brush: plain; light: true; "><br />## With ESXi, same hardware ##<br />[root@files ~]# hdparm -t /dev/mapper/openfiler-data <br /><br />/dev/mapper/openfiler-data:<br /> Timing buffered disk reads:  200 MB in  3.18 seconds =  62.92 MB/sec<br /></pre><br /><br />