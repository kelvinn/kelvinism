<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>Articles | Kelvin Nicholson</title>
<meta name="keywords" content="">
<meta name="description" content="">
<meta name="author" content="">
<link rel="canonical" href="http://localhost:1313/tags/articles/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.746054a45389a17441e7242a7b3d450992663ac8002dd8afb1bc3ab4255ca3d1.css" integrity="sha256-dGBUpFOJoXRB5yQqez1FCZJmOsgALdivsbw6tCVco9E=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" type="application/rss+xml" href="http://localhost:1313/tags/articles/index.xml">
<link rel="alternate" hreflang="en" href="http://localhost:1313/tags/articles/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
</head>

<body class="list" id="top">
<div id='redbar'></div>
<div id='greenbar'></div>

<div class="container">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>




<header class="header">
    <a href='/'><span id='logo'></span></a>
    <ul>
        <li><a href='/tags/travel/'>Travel</a></li>
        <li><a href='/tags/longevity/'>Longevity</a></li>
        <li><a href='/tags/projects/'>Projects</a></li>
        <li><a href='/tags/howtos/'>Tutorials</a></li>
        <li><a href='/about/'>Who</a></li>
    </ul>

</header><main class="main"> 

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="post-title entry-hint-parent">
      
      <a aria-label="post link to OpenFiler Permission Issue" href="http://localhost:1313/2008/12/openfiler-permission-issue_2907.html">OpenFiler Permission Issue </a>
      
      
    </h2>

    <div class="post-meta"><span title='2008-12-07 21:30:00.01 +1100 AEDT'>Published on December 7, 2008</span>&nbsp;·&nbsp;1 min

</div>
  </header>

  <div class="entry-content">
    <p>I&rsquo;ve had issues before with OpenFiler where doesn&rsquo;t update the permissions, although they appear correct in the UI. To rectify that, I stumbled upon a one liner that fixed it. Let&rsquo;s say you have a group called &ldquo;Trusted&rdquo; that you want to have full access to your music folder. Here&rsquo;s the one-liner:</p>
<pre tabindex="0"><code>\[root@files data\]# pwd
/mnt/openfiler/data
root@files data\]# setfacl --recursive -m u:nobody:rwx,g:Trusted:rwx music
</code></pre>
  </div>

  
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="post-title entry-hint-parent">
      
      <a aria-label="post link to Speeding Up VMWare Server" href="http://localhost:1313/2008/12/speeding-up-vmware-server_791.html">Speeding Up VMWare Server </a>
      
      
    </h2>

    <div class="post-meta"><span title='2008-12-07 21:30:00.008 +1100 AEDT'>Published on December 7, 2008</span>&nbsp;·&nbsp;2 min

</div>
  </header>

  <div class="entry-content">
    <p>I found VMWare Server to have very slow I/O, and sought to improve it. Below are a list of tests I performed, the change, and the results.</p>
<pre tabindex="0"><code>  
  
\### Host OS ###  
/dev/sdb1:  
 Timing buffered disk reads:  220 MB in  3.05 seconds =  72.17 MB/sec  
kelvin@gorilla:~$ sudo hdparm -t /dev/sdb1  
  
/dev/sdb1:  
 Timing buffered disk reads:  266 MB in  3.01 seconds =  88.33 MB/sec  
kelvin@gorilla:~$ sudo hdparm -t /dev/sdb1  
  
/dev/sdb1:  
 Timing buffered disk reads:  310 MB in  3.01 seconds = 102.99 MB/sec  
  
  
\### Before Changes ###  
  
/dev/mapper/openfiler-data:  
 Timing buffered disk reads:    8 MB in  3.36 seconds =   2.38 MB/sec  
\[root@files etc\]# hdparm -t /dev/mapper/openfiler-data  
  
/dev/mapper/openfiler-data:  
 Timing buffered disk reads:   24 MB in  3.63 seconds =   6.61 MB/sec  
\[root@files etc\]# hdparm -t /dev/mapper/openfiler-data  
  
/dev/mapper/openfiler-data:  
 Timing buffered disk reads:   28 MB in  4.54 seconds =   6.16 MB/sec  
  
</code></pre><p>I made several changes, but the changes that seemed to have the most impact are below:</p>
<pre tabindex="0"><code>  
  
vm.dirty\_background\_ratio = 5  
vm.dirty\_ratio = 10  
vm.swappiness = 0  
  
</code></pre><p>Pop this into the virtual machine&rsquo;s .vmx file, reboot, and off you go. One unfortunate side effect is that you can no longer overload the memory (e.g. allocate more memory with the VMs than you actually have available).</p>
<pre tabindex="0"><code>  
  
\### After Changes ###  
  
/dev/mapper/openfiler-data:  
 Timing buffered disk reads:   52 MB in  3.13 seconds =  16.61 MB/sec  
\[root@files ~\]# hdparm -t /dev/mapper/openfiler-data  
  
/dev/mapper/openfiler-data:  
 Timing buffered disk reads:   82 MB in  3.31 seconds =  24.75 MB/sec  
\[root@files ~\]# hdparm -t /dev/mapper/openfiler-data  
  
/dev/mapper/openfiler-data:  
 Timing buffered disk reads:  118 MB in  3.19 seconds =  36.97 MB/sec  
\[root@files ~\]# hdparm -t /dev/mapper/openfiler-data  
  
/dev/mapper/openfiler-data:  
 Timing buffered disk reads:  144 MB in  3.32 seconds =  43.37 MB/sec  
  
\[root@files ~\]# hdparm -t /dev/mapper/openfiler-data  
  
/dev/mapper/openfiler-data:  
 Timing buffered disk reads:  160 MB in  3.10 seconds =  51.57 MB/sec  
  
  
</code></pre><p><strong>UPDATE</strong>: Those wanting all the speed and still want to use memory overloading, I&rsquo;d suggested you give ESXi a try. So far, so good.</p>
<pre tabindex="0"><code>  
\## With ESXi, same hardware ##  
\[root@files ~\]# hdparm -t /dev/mapper/openfiler-data   
  
/dev/mapper/openfiler-data:  
 Timing buffered disk reads:  200 MB in  3.18 seconds =  62.92 MB/sec  
</code></pre>
  </div>

  
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="post-title entry-hint-parent">
      
      <a aria-label="post link to Integrating OSSEC with Cisco IOS" href="http://localhost:1313/2008/11/integrating-ossec-with-cisco-ios_7061.html">Integrating OSSEC with Cisco IOS </a>
      
      
    </h2>

    <div class="post-meta"><span title='2008-11-15 21:30:00.002 +1100 AEDT'>Published on November 15, 2008</span>&nbsp;·&nbsp;3 min

</div>
  </header>

  <div class="entry-content">
    <p>I rank OSSEC as one of my favorite pieces of open source software, and finally decided to play around with it more in my own free time. (Yup, I do this sort of stuff for <em>fun</em>). My goal was quite simple: send syslog packets from my Cisco to my &ldquo;proxy&rdquo; server, running OSSEC. I found that, although OSSEC supports Cisco IOS logging, it didn&rsquo;t really work. In fact, I couldn&rsquo;t find any examples or articles of anybody actually getting it to work.</p>
<p>I initially tried to get it to work &ldquo;correctly,&rdquo; and soon settled to &ldquo;just getting it to work.&rdquo; I implemented some rules in the local_rules.xml file, which worked, but I&rsquo;m pretty stubborn, and wanted to do it &ldquo;correctly.&rdquo; With a couple pots of tea, and the support of my girlfriend, I became much, much more familiar with OSSEC. The key (and a lot of credit) goes to Jeremy Melanson for <a href="http://www.ossec.net/ossec-list/2007-September/msg00124.html">hinting at some of the updates</a> to the decoder.xml file that need to take place.</p>
<p>The first step is to read the OSSEC + Cisco IOS <a href="http://www.ossec.net/wiki/index.php/PIX_and_IOS_Syslog_Config_examples#Configuring_Cisco_IOS_router">wiki page</a>. Everything on that page is pretty straight forward. I then added three explicit drop rules at the end of my Cisco&rsquo;s ACL:</p>
<pre tabindex="0"><code>...

access-list 101 deny tcp any host 220.244.xxx.xxx log
access-list 101 deny ip any host 220.244.xxx.xxx log
access-list 101 deny udp any host 220.244.xxx.xxx log
</code></pre><p>(220.244.xxx.xxx is my WAN IP, and I&rsquo;m sure you could figure out xxx.xxx pretty darn easily, but I&rsquo;ll x them out anyways).</p>
<p>To reiterate, OSSEC needs to be told to listen for syslog traffic, which you should be set on the Cisco. If you haven&rsquo;t done this, go re-read the wiki above.</p>
<pre tabindex="0"><code> syslog
192.168.0.1 
</code></pre><p>On or around line 1550 in /var/ossec/etc/decoder.xml I needed to update the regex that was used to detect the syslog stream.</p>
<pre tabindex="0"><code>...

 ^%\\w+-\\d-\\w+: |^: %\\w+-\\d-\\w+: 

 ^%\\w+-\\d-\\w+: |^: %\\w+-\\d-\\w+: 

 cisco-ios
firewall
^%SEC-6-IPACCESSLOGP: |^: %SEC-6-IPACCESSLOGP: 
^list \\d+ (\\w+) (\\w+) 
(\\S+)\\((\\d+)\\) -&gt; (\\S+)\\((\\d+)\\),
action, protocol, srcip, srcport, dstip, dstport 

...
</code></pre><p>In the general OSSEC configuration file, re-order the list of rules. I had to do this because syslog_rules.xml includes a search for &ldquo;denied&rdquo;, and that triggers an alarm.</p>
<pre tabindex="0"><code>...
telnetd\_rules.xml
cisco-ios\_rules.xml
syslog\_rules.xml
arpwatch\_rules.xml
...
</code></pre><p>Remember that these dropped events will go into /var/ossec/logs/firewall/firewall.log. Because this is my home connection, and I don&rsquo;t have any active_responses configured (yet!), I tightened the firewall_rules.xml file (lowering the frequency, raising the timeframe).</p>
<p>And in the end, I get a pretty email when somebody tries to port scan me.</p>
<h4 id="pretty-email">Pretty email</h4>
<pre tabindex="0"><code>OSSEC HIDS Notification.
2008 Nov 15 23:19:36

Received From: proxy-&gt;xxx.xxx.xxx.xxx
Rule: 4151 fired (level 10) -&gt; &#34;Multiple Firewall drop events from same source.&#34;
Portion of the log(s):

: %SEC-6-IPACCESSLOGP: list 101 denied tcp 4.79.142.206(36183) -&gt; 220.244.xxx.xxx(244), 1 packet 
: %SEC-6-IPACCESSLOGP: list 101 denied tcp 4.79.142.206(36183) -&gt; 220.244.xxx.xxx(253), 1 packet 
: %SEC-6-IPACCESSLOGP: list 101 denied tcp 4.79.142.206(36183) -&gt; 220.244.xxx.xxx(243), 1 packet 
: %SEC-6-IPACCESSLOGP: list 101 denied tcp 4.79.142.206(36183) -&gt; 220.244.xxx.xxx(254), 1 packet 



--END OF NOTIFICATION
</code></pre>
  </div>

  
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="post-title entry-hint-parent">
      
      <a aria-label="post link to Upgrading Cisco Wireless Firmware" href="http://localhost:1313/2008/11/upgrading-cisco-wireless-firmware_3066.html">Upgrading Cisco Wireless Firmware </a>
      
      
    </h2>

    <div class="post-meta"><span title='2008-11-03 21:30:00.002 +1100 AEDT'>Published on November 3, 2008</span>&nbsp;·&nbsp;1 min

</div>
  </header>

  <div class="entry-content">
    <p>I&rsquo;m always forgetting the exact string to enter at the CLI for updating the IOS on a wireless Cisco AP, so I&rsquo;ll just put it here to end my future searches:</p>
<pre tabindex="0"><code>Chimp# archive download-sw /force-reload /overwrite tftp://192.168.83.150/c1100-k9w7-tar.123-8.JEC1.tar
</code></pre><p>192.168.83.150 obviously being your tftp server, and the .tar file sitting in the root of the tftp server.</p>
<p>I suppose if you wanted to backup your IOS you could do something along the lines of:</p>
<pre tabindex="0"><code>Chimp# archive upload-sw tftp://192.168.83.150/someimage.tar
</code></pre><p>But I haven&rsquo;t tried it&hellip;</p>

  </div>

  
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="post-title entry-hint-parent">
      
      <a aria-label="post link to Slope Finder for the Missus" href="http://localhost:1313/2008/11/slope-finder-for-missus_5304.html">Slope Finder for the Missus </a>
      
      
    </h2>

    <div class="post-meta"><span title='2008-11-02 21:30:00.008 +1100 AEDT'>Published on November 2, 2008</span>&nbsp;·&nbsp;1 min

</div>
  </header>

  <div class="entry-content">
    <p>Since I do sysadminy stuff all day, I don&rsquo;t really get a chance to do much coding (or not as much of a chance as I would like). You can imagine my joy when my girlfriend expressed a problem she needed solved: &ldquo;I&rsquo;m going to need to solve 100s of slope equations, i.e. where two lines intersect. Can you write a program to do it?&rdquo; Sure!</p>
<p>I asked if she wanted to do a batch input or just a one-off type of deal, she decided on the latter. Although I&rsquo;ve done a fair bit of PyGTK stuff, I had never actually needed to convert it to Windows. I debated using IronPython &ndash; but needed to use a special library to help solve the equations (I&rsquo;m lazy).</p>
<p>So, where is the power in Python? After about 15-20m I had a console based app that could solve the slopes. I added the Linux GUI part in maybe 45m, and then the Windows part in, well, not 45m!</p>
<p>Either way, screenshot is below. Thanks girlfriend, I had fun!</p>
<p><a href="http://picasaweb.google.com/lh/photo/z7c7K2SAI4DQi84sBKkiGA?feat=embedwebsite"><img loading="lazy" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgEAxIIJW4HIfuL3VFBYCY8aQM8pVChFP5qcxi3_Daaay5oN2OEJ4XstDByk-fOFICyJUfkp3Beerf12V4n3HmWFn_4WNd36bvDOFd0y5Grx6cgo5WpICpgFU5exuS0zwHrCNTaSHeuzMOt/s800/slopefinder.jpg"></a></p>

  </div>

  
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="post-title entry-hint-parent">
      
      <a aria-label="post link to Capped Internet" href="http://localhost:1313/2008/11/capped-internet_4903.html">Capped Internet </a>
      
      
    </h2>

    <div class="post-meta"><span title='2008-11-01 21:30:00.004 +1100 AEDT'>Published on November 1, 2008</span>&nbsp;·&nbsp;2 min

</div>
  </header>

  <div class="entry-content">
    <p>I&rsquo;ve lived in several different parts of the world, and they all do internet differently. Back in the US I had 8Mb/sec cable (leaving just before Fios was really an option, darn!) In New Zealand, for instance, I was paying for &ldquo;high speed ADSL&rdquo; rated at 1.5Mb/256k. Vrooom. Up in Taiwan I was paying 1/2 what I paid in New Zealand, but for 12Mb/1Mb. Down to Sydney and we have a rated 24Mb/1Mb.</p>
<p>But there&rsquo;s a catch with the plans in New Zealand and Australia: they are &lsquo;capped&rsquo;. This means you only get XGB/month &ndash; and it isn&rsquo;t like Comcast capping at 250GB/month, I&rsquo;m talking about 1GB/5GB/10GB and so forth. And there&rsquo;s more &ndash; just like mobile phones, you get on-peak and off-peak times.</p>
<p>This all does make a bit of sense to me &ndash; there are only X amount of tubes going in and out of NZ and AU, and I would imagine they get pretty clogged.</p>
<p>Either way, last month was pretty painful. Two weeks into our plan I checked out usage: 14GB of 18GB! We had only 4GB left to use for 15 days. This sounds like a lot, but for the two of us, and my 10 virtual servers, it isn&rsquo;t. The first thing I did was looking at a way to do WSUS with Linux &ndash; I ended up using apt-cacher (I&rsquo;m using only Ubuntu at home). BitTorrent, out; downloading any new ISOs, out; streaming music, totally out. For a while I has to VPN to home, and then VPN to a client, as our router at work didn&rsquo;t seem to like letting us access one of our clients. I even disconnected from the VPN if I wouldn&rsquo;t be doing work for 20m!</p>
<p>We eventually made it, and used only 2GB in two weeks. What an accomplishment!</p>

  </div>

  
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="post-title entry-hint-parent">
      
      <a aria-label="post link to VM Automatic Startup in Server 2" href="http://localhost:1313/2008/08/vm-automatic-startup-in-server-2_6579.html">VM Automatic Startup in Server 2 </a>
      
      
    </h2>

    <div class="post-meta"><span title='2008-08-02 20:30:00.002 +1000 AEST'>Published on August 2, 2008</span>&nbsp;·&nbsp;1 min

</div>
  </header>

  <div class="entry-content">
    <p>I think possibly one of the most practical upgrades in VMware Server 2 appears to be the ability to automatically turn on virtual machines in a stagnated order. I have fond memories of turning on a server with 10 virtual machines, and when they all turn on at once, the hard disk grinds to a halt. This forced me to turn on the machines manually afterwards.</p>
<p>+1 VMware in my books.</p>

  </div>

  
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="post-title entry-hint-parent">
      
      <a aria-label="post link to GUI to Plot Driving Speed" href="http://localhost:1313/2008/05/gui-to-plot-driving-speed_6997.html">GUI to Plot Driving Speed </a>
      
      
    </h2>

    <div class="post-meta"><span title='2008-05-27 20:30:00.002 +1000 AEST'>Published on May 27, 2008</span>&nbsp;·&nbsp;1 min

</div>
  </header>

  <div class="entry-content">
    <p>I needed another Python fix, and I need one pretty badly. I spent the weekend wondering why it appears to be impossible to edit the GUIDs inside an Exchange mailbox store (read: NOT the GUIDs stored in AD for Exchange). Anyways, I digress.</p>
<p>My goals were simple. I wanted to use Python, wanted something to do with traffic, and wanted to play around with Glade/PyGTK and graphing stuff. My end result was a little app that allows you to specify a GPX file, and it plots the waypoints (and calculates the moving average!). Pretty simple, pretty useless, but pretty fun. I really do like pretty pictures.</p>
<p><a href="http://picasaweb.google.com/lh/photo/qv9V1YGpNjeYA0oywW8BGA?feat=embedwebsite"><img loading="lazy" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgbsbQ8Cni_yPDyZ4MPoq2GXKP-XOFmq9aEpdc3acy9aMR5QemSj4UXMS1rGJ0IUSF3yc3unogl13DXYQM9z3wD_PmGreclmzDvmaqzJlSEuHJnq-sysd-r34mpNlI1gLOFwuWuyIWfRFp8/s400/SpeedPlotrX.jpg"></a></p>
<p>I ended up using matplotlab for the graphing part, but I don&rsquo;t really like how the graphs look. I will likely use Pycha (which dips into Cairo) for my future projects &ndash; but we&rsquo;ll see when that point comes. (If data sensitivity wasn&rsquo;t an issue, I would totally use Google Charts, since I&rsquo;m a sucker for APIs).</p>

  </div>

  
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="post-title entry-hint-parent">
      
      <a aria-label="post link to Another Baby Step" href="http://localhost:1313/2008/04/another-baby-step_1340.html">Another Baby Step </a>
      
      
    </h2>

    <div class="post-meta"><span title='2008-04-29 20:30:00.006 +1000 AEST'>Published on April 29, 2008</span>&nbsp;·&nbsp;1 min

</div>
  </header>

  <div class="entry-content">
    <p>I showed a few of my co-workers my graph and one replied &ndash; oh! that&rsquo;s really cool. (I think only two of my co-workers are actually interested in my geekyness). He then emailed me tonight a .kmz file containing a colorized file of his speed. I looked at the kml and noticed it appeared to be dynamically allocated judging by the top speed. Well, as you could guess, I surely had to modify my code to include colors.</p>
<p>Within an hour I had a semi-working example, and within two hours will easily be done with this blog post. The code might not be perfect, but it first parses the xml and returns the max speed for the trip. Next, it colorizes the speeds based on a scale of 0-255, with 0 being blue for fast and 255 for being yellow, or slow. I was going to study for the CCNA tonight, but it looks like writing Python is just too much fun.</p>
<p><a href="http://picasaweb.google.com/lh/photo/vQ_v3bb0f6QLHiOEEShN1Q?feat=embedwebsite"><img loading="lazy" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhHE0LrPY3qk6xEJfwkyjpNu6wcJtGv9vtho2gi7W9NCTbViKUXsImuIoNjcoZGTiSTTrGkRCOzb_WP8RE7wTweah7WkOwdp1x6b2b7teDvMvGcf2u-Ou9jYkfyKTDXpWY8N8J_GYEDYKkI/s288/gpstracks1.jpg"></a></p>
<p><a href="http://picasaweb.google.com/lh/photo/L7745TDqLkWkkftff8bV8g?feat=embedwebsite"><img loading="lazy" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhySCFquf2IZDhKtK0aJNzlga4jA04ye11unofmz42J5_UB1AdyLDrsuxfZCwVUuj-9HBPcs04l3vkke-S3aMfbdI_2i6iwM4pmL4WFrCpD6YmSUJ9T8I6ixMDzhnuX7-I62nPs8VsP8gXx/s288/gpstracks2.jpg"></a></p>
<p>So what, you might ask, are those dips? Good question. They are huge speed bumps (and the tall blue mound in the middle is a really steep hill).</p>

  </div>

  
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="post-title entry-hint-parent">
      
      <a aria-label="post link to Event vs. DOM Driven Parsing of XML" href="http://localhost:1313/2008/04/event-vs-dom-driven-parsing-of-xml_6678.html">Event vs. DOM Driven Parsing of XML </a>
      
      
    </h2>

    <div class="post-meta"><span title='2008-04-29 20:30:00.007 +1000 AEST'>Published on April 29, 2008</span>&nbsp;·&nbsp;2 min

</div>
  </header>

  <div class="entry-content">
    <p>I recently have been <a href="http://www.kelvinism.com/tech-blog/baby-steps-graphing-traffic/">playing</a> with parsing GPX files and spitting out the results into a special KML file. I initially wrote a parser using minidom, yet after running this the first time &ndash; and my Core2Duo laptop reaching 100% utilization for 10 seconds &ndash; I realized I needed to re-write it using something else.</p>
<p>I spent a little time reading the different parsers for XML and eventually read more about <a href="http://effbot.org/zone/celementtree.htm">cElementTree</a>. And it is included with Python2.5, sweet.</p>
<p>I quickly rewrote the code and did some tests. First, the two bits of code for parsing my GPX file:</p>
<p><strong>minidom-speed.py</strong></p>
<pre tabindex="0"><code>#!/usr/bin/python

from xml.dom import minidom
from genshi.template import TemplateLoader

def collect\_info():
dom = minidom.parse(&#39;airport.gpx&#39;)
for node in dom.getElementsByTagName(&#39;trkpt&#39;):
lat = node.getAttribute(&#39;lat&#39;)
lon = node.getAttribute(&#39;lon&#39;)
speed = node.getElementsByTagName(&#39;speed&#39;)\[0\].firstChild.data
speed = float(speed) \* 10
coords = &#39;%s,%s&#39; % (lon, lat)
coords\_speed = &#39;%s,%s&#39; % (coords, speed)
yield {
&#39;coordinates&#39;: coords\_speed
}

loader = TemplateLoader(\[&#39;.&#39;\])
template = loader.load(&#39;template-speed.kml&#39;)
stream = template.generate(collection=collect\_info())

f = open(&#39;minidom.kml&#39;, &#39;w&#39;)
f.write(stream.render())
</code></pre><p><strong>cet-speed.py</strong></p>
<pre tabindex="0"><code>#!/usr/bin/python

import sys,os
import xml.etree.cElementTree as ET
import string
from genshi.template import TemplateLoader

def collect\_info():
mainNS=string.Template(&#34;{http://www.topografix.com/GPX/1/0}$tag&#34;)

wptTag=mainNS.substitute(tag=&#34;trkpt&#34;)
nameTag=mainNS.substitute(tag=&#34;speed&#34;)

et=ET.parse(open(&#34;airport.gpx&#34;))
for wpt in et.findall(&#34;//&#34;+wptTag):
wptinfo=\[\]
wptinfo.append(wpt.get(&#34;lon&#34;))
wptinfo.append(wpt.get(&#34;lat&#34;))
wptinfo.append(str(float(wpt.findtext(nameTag)) \* 10))
coords\_speed = &#34;,&#34;.join(wptinfo)
yield {
&#39;coordinates&#39;: coords\_speed,
}

loader = TemplateLoader(\[&#39;.&#39;\])
template = loader.load(&#39;template-speed.kml&#39;)
stream = template.generate(collection=collect\_info())

f = open(&#39;cet.kml&#39;, &#39;w&#39;)
f.write(stream.render())
</code></pre><p>The speed difference is not just noticeable, but <strong>very</strong> noticeable.</p>
<p><strong>minidom-speed.py</strong></p>
<pre tabindex="0"><code>$ python -m cProfile minidom-speed.py
4405376 function calls (3787047 primitive calls) in 32.142 CPU seconds
</code></pre><p><strong>cet-speed.py</strong></p>
<pre tabindex="0"><code>$ python -m cProfile cet-speed.py
1082061 function calls (904167 primitive calls) in 6.736 CPU seconds
</code></pre><p>A quarter as many calls and almost 5x faster &ndash; at least that&rsquo;s how I interpret the results. Much better!</p>

  </div>

  
</article>
<footer class="page-footer">
  <nav class="pagination">
    <a class="prev" href="http://localhost:1313/tags/articles/page/4/">
      «&nbsp;Prev&nbsp;
    </a>
    <a class="next" href="http://localhost:1313/tags/articles/page/6/">Next&nbsp;&nbsp;»
    </a>
  </nav>
</footer>
    </main>

    </div>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/">Kelvin Nicholson</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
