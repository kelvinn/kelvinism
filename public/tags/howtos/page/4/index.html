<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>Howtos | Kelvin Nicholson</title>
<meta name="keywords" content="">
<meta name="description" content="">
<meta name="author" content="">
<link rel="canonical" href="http://localhost:1313/tags/howtos/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.e5d5fdc18d3ba93e96e9e0174d23fd3f2b9076ee85fb125cc29d561cc8955db8.css" integrity="sha256-5dX9wY07qT6W6eAXTSP9PyuQdu6F&#43;xJcwp1WHMiVXbg=" rel="preload stylesheet" as="style"><script src='/js/syntaxhighlighter.js' type='text/javascript'></script>
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" type="application/rss+xml" href="http://localhost:1313/tags/howtos/index.xml">
<link rel="alternate" hreflang="en" href="http://localhost:1313/tags/howtos/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript>
</head>

<body class="list" id="top">
<div id='redbar'></div>
<div id='greenbar'></div>

<div class="container">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    }

</script>




<header class="header">
    <a href='/'><span id='logo'></span></a>
    <ul>
        <li><a href='/tags/travel/'>Travel</a></li>
        <li><a href='/tags/longevity/'>Longevity</a></li>
        <li><a href='/tags/projects/'>Projects</a></li>
        <li><a href='/tags/howtos/'>Tutorials</a></li>
        <li><a href='/about/'>Who</a></li>
    </ul>

</header><main class="main"> 

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="post-title entry-hint-parent">
      
      <a aria-label="post link to Files between ESX and Linux via NFS" href="http://localhost:1313/2009/03/files-between-esx-and-linux-via-nfs_6022.html">Files between ESX and Linux via NFS </a>
      
      
    </h2>

    <div class="post-meta"><span title='2009-03-02 21:30:00.002 +1100 AEDT'>Published on March 2, 2009</span>&nbsp;·&nbsp;1 min

</div>
  </header>

  <div class="entry-content">
    <p>I like ESX. I like Linux. It is absurdly easy to configure Linux as an NFS server and mount it in ESXIi).</p>
<p><strong>Installed NFS</strong></p>
<p>I currently use Ubuntu Server for my home lab, but the process is basically the same for Red Hat and derivatives.</p>
<pre tabindex="0"><code>sudo apt-get install nfs-common
sudo apt-get install nfs-kernel-server
</code></pre><p>Next, configure NFS so it can server your local LAN. Normally you would list only specific servers, but, well, we&rsquo;re being cheap and dirty today. Open /etc/exports in VI or your editor of choice.</p>
<p><strong>/etc/exports</strong></p>
<pre tabindex="0"><code>/media/disk/Images 192.168.0.0/24(rw,no\_root\_squash,async
</code></pre><p>Restart NFS.</p>
<pre tabindex="0"><code>sudo /etc/init.d/nfs-common
</code></pre><p>Go to Configuration -&gt; Storage -&gt; Add Storage.</p>
<p>Select NFS</p>
<p>Fill in the info, see screenshot.</p>
<p>Wait a minute. Voila! New datastore.</p>
<p><strong>Images to come shortly.</strong></p>

  </div>

  
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="post-title entry-hint-parent">
      
      <a aria-label="post link to Beginning Scripting ESXi" href="http://localhost:1313/2009/01/beginning-scripting-esxi_6126.html">Beginning Scripting ESXi </a>
      
      
    </h2>

    <div class="post-meta"><span title='2009-01-06 21:30:00.002 +1100 AEDT'>Published on January 6, 2009</span>&nbsp;·&nbsp;3 min

</div>
  </header>

  <div class="entry-content">
    <p>I&rsquo;m not impressed too often with much software, especially the closed source kind. I find a leaning preference to all things FOSS. If I had a million dollars, I&rsquo;d likely spend all day contributing to all the projects I wish I had time to contribute to. Regardless, there are a select few closed-source products that I believe are truly excellent. I mean, the type of software where you aren&rsquo;t asking &ldquo;I wish this could do this&rdquo; and start asking &ldquo;I wonder what else this can do.&rdquo;</p>
<p>While I&rsquo;ve played around with most types of virtualization out there (OpenVZ, Xen, V-Server, qemu&hellip;), I&rsquo;ve really found a soft spot for VMWare.</p>
<p>Don&rsquo;t get me wrong, if I was going to host a heap of Linux web servers I would absolutely use Xen, but for a heterogeneous environment, I haven&rsquo;t used anything as easy as VMWare&rsquo;s products. Not that I judge a product by how easy it is to use, not by a long shot, but ease of use sure makes judging other factors easier.</p>
<p>Regardless, this isn&rsquo;t a post trumpeting VMWare. I just realized tonight that some of the VMs I have running don&rsquo;t need to be except for certain hours of the day, or if condition A is true. The first example is my backup mail server; I really don&rsquo;t need it even powered on unless my main server is down. The second example is my Server 2003 instance, which has VI3 on it; I don&rsquo;t need this running unless I&rsquo;m asleep. One of the most useful resources I&rsquo;ve seen for the vmrun command is over at <a href="http://www.virtuatopia.com/index.php/Controlling_VMware_Virtual_Machines_from_the_Command_Line_with_vmrun">VirtualTopia</a> &ndash; loaded with examples.</p>
<h4 id="turn-off-via-time">Turn off via time</h4>
<p>On my &ldquo;monitoring&rdquo; instance, which is always up, I&rsquo;ve decided to install the script that controls my VM. I&rsquo;ve opted to use a soft shutdown.</p>
<p>192.168.0.10 = ESXi box</p>
<p>datastore1 = name of datastore that hosts VMs</p>
<pre tabindex="0"><code>#!/bin/sh

vmrun -t esx -h https://192.168.0.10/sdk -u root -p root\_password stop &#34;\[datastore1\] Server 2003 R2/Server 2003 R2.vmx&#34; soft
</code></pre><p>I have that saved in a file called <strong>stop_2003.sh</strong> in /opt/vmware/bin; make sure it isn&rsquo;t world readable. I also have a <strong>start_2003.sh</strong>:</p>
<pre tabindex="0"><code>#!/bin/sh

vmrun -t esx -h https://192.168.0.10/sdk -u root -p root\_password start &#34;\[datastore1\] Server 2003 R2/Server 2003 R2.vmx&#34;
</code></pre><p>Next, edit root&rsquo;s crontab (crontab -e):</p>
<pre tabindex="0"><code>\# m h  dom mon dow   command
0 8 \* \* \* /opt/vmware/bin/start\_2003.sh
0 23 \* \* \* /opt/vmware/bin/stop\_2003.sh
</code></pre><p>The conditional task is a tad bit more tricky, but just a tad. Ping won&rsquo;t do, since the mailserver could go down itself, so install nmap. Create a script:</p>
<pre tabindex="0"><code>#!/bin/bash

if nmap -p25 -PN -sT -oG - mail.kelvinism.com | grep &#39;Ports:.\*/open/&#39; &gt;/dev/null ; then
echo \`time\` &gt;&gt; mailserver.log
else
/opt/vmware/bin/start\_mail.sh
fi
</code></pre><p>And sticking with our theme, <strong>start_mail.sh</strong>:</p>
<pre tabindex="0"><code>#!/bin/sh

vmrun -t esx -h https://192.168.0.10/sdk -u root -p root\_password start &#34;\[datastore1\] Mail Server/Mail Server.vmx&#34;
</code></pre><p>This of course changes the crontab entry to:</p>
<pre tabindex="0"><code>\# m h  dom mon dow   command
0 8 \* \* \* /opt/vmware/bin/start\_2003.sh
0 23 \* \* \* /opt/vmware/bin/stop\_2003.sh
\*/5 \* \* \* \* /opt/vmware/bin/detect\_port.sh
</code></pre><p>So, that&rsquo;s it. detect_port.sh is lacking any type of error detection or redundancy - if one packet/scan is dropped, the mail server will turn on. I&rsquo;ll re-work this at some point, but it works for now.</p>
<p><strong>Update</strong>: Vmware has also released a decent blog entry about using vmrun: <a href="http://blogs.vmware.com/vix/2008/12/managing-vm-guests-using-vmrun.html">on their blog</a>.</p>

  </div>

  
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="post-title entry-hint-parent">
      
      <a aria-label="post link to NetFlow into MySQL with flow-tools" href="http://localhost:1313/2008/12/netflow-into-mysql-with-flow-tools_5439.html">NetFlow into MySQL with flow-tools </a>
      
      
    </h2>

    <div class="post-meta"><span title='2008-12-21 21:30:00.002 +1100 AEDT'>Published on December 21, 2008</span>&nbsp;·&nbsp;2 min

</div>
  </header>

  <div class="entry-content">
    <p>I&rsquo;ve been side-tracked on another little project, and keep coming back to NetFlow. For this project I&rsquo;ll need to access NetFlow data with <a href="http://www.djangoproject.com">Django</a>, but this is a bit tricky. First, I&rsquo;m sort of lazy when it comes to my own project; maybe not lazy, I just like taking the most direct route. The most up-to-date NetFlow collector I noticed was <a href="http://code.google.com/p/flow-tools/">flow-tools</a>, and there is even a switch to export the information into MySQL. Sweet! However, I wanted to insert the flows into MySQL automatically, or at least on a regular basis. I first started writing a python script that would do the job, but after a few minutes noticed flow-capture had a rotate_program switch, and started investigating. Since I somehow couldn&rsquo;t find anywhere instructions how to insert the data automatically, here&rsquo;s what I came up with:</p>
<ol>
<li>
<p>Download <a href="http://code.google.com/p/flow-tools/">flow-tools</a>; make sure to configure with &ndash;with-mysql (and you&rsquo;ll have to make sure you have the needed libraries).</p>
</li>
<li>
<p>Create a new database, I called mine &rsquo;netflow'.</p>
</li>
<li>
<p>Create a table that can contain all the netflow fields, a sample is below. I added a &ldquo;flow_id&rdquo; field that I used as a primary key, but you don&rsquo;t necessarily need this.</p>
</li>
</ol>
<pre tabindex="0"><code>CREATE TABLE \`flows\` (
\`FLOW\_ID\` int(32) NOT NULL AUTO\_INCREMENT,
\`UNIX\_SECS\` int(32) unsigned NOT NULL default &#39;0&#39;,
\`UNIX\_NSECS\` int(32) unsigned NOT NULL default &#39;0&#39;,
\`SYSUPTIME\` int(20) NOT NULL,
\`EXADDR\` varchar(16) NOT NULL,
\`DPKTS\` int(32) unsigned NOT NULL default &#39;0&#39;,
\`DOCTETS\` int(32) unsigned NOT NULL default &#39;0&#39;,
\`FIRST\` int(32) unsigned NOT NULL default &#39;0&#39;,
\`LAST\` int(32) unsigned NOT NULL default &#39;0&#39;,
\`ENGINE\_TYPE\` int(10) NOT NULL,
\`ENGINE\_ID\` int(15) NOT NULL,
\`SRCADDR\` varchar(16) NOT NULL default &#39;0&#39;,
\`DSTADDR\` varchar(16) NOT NULL default &#39;0&#39;,
\`NEXTHOP\` varchar(16) NOT NULL default &#39;0&#39;,
\`INPUT\` int(16) unsigned NOT NULL default &#39;0&#39;,
\`OUTPUT\` int(16) unsigned NOT NULL default &#39;0&#39;,
\`SRCPORT\` int(16) unsigned NOT NULL default &#39;0&#39;,
\`DSTPORT\` int(16) unsigned NOT NULL default &#39;0&#39;,
\`PROT\` int(8) unsigned NOT NULL default &#39;0&#39;,
\`TOS\` int(2) NOT NULL,
\`TCP\_FLAGS\` int(8) unsigned NOT NULL default &#39;0&#39;,
\`SRC\_MASK\` int(8) unsigned NOT NULL default &#39;0&#39;,
\`DST\_MASK\` int(8) unsigned NOT NULL default &#39;0&#39;,
\`SRC\_AS\` int(16) unsigned NOT NULL default &#39;0&#39;,
\`DST\_AS\` int(16) unsigned NOT NULL default &#39;0&#39;,
PRIMARY KEY (FLOW\_ID)
) ENGINE=MyISAM DEFAULT CHARSET=utf8;
</code></pre><ol start="4">
<li>
<p>Setup your router so it sends netflow packets to your linux box (see README/INSTALL)</p>
</li>
<li>
<p>Create a &ldquo;rotate program&rdquo; that will actually enter in the information into mysql.</p>
</li>
</ol>
<pre tabindex="0"><code>kelvin@monitor:/usr/bin$ cat flow-mysql-export 
#!/bin/bash

flow-export -f3 -u &#34;username:password:localhost:3306:netflow:flows&#34; &lt; /flows/router/$1
</code></pre><ol start="6">
<li>
<p>Create the /flows/router directory</p>
</li>
<li>
<p>Start flow-capture (9801 is the port netflow traffic is being directed to); all done.</p>
</li>
</ol>
<pre tabindex="0"><code>flow-capture -w /flows/router -E5G 0/0/9801 -R /usr/bin/flow-mysql-export
</code></pre>
  </div>

  
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="post-title entry-hint-parent">
      
      <a aria-label="post link to Zenoss Default Password" href="http://localhost:1313/2008/12/zenoss-default-password_1357.html">Zenoss Default Password </a>
      
      
    </h2>

    <div class="post-meta"><span title='2008-12-20 21:30:00.002 +1100 AEDT'>Published on December 20, 2008</span>&nbsp;·&nbsp;1 min

</div>
  </header>

  <div class="entry-content">
    <p>I&rsquo;ve evaluated Zenoss before, but forgot the default password, and searching for it didn&rsquo;t come up with anything quickly. I tried everything under the sun: password, 1234, admin, God, Sex, but alas, grep to the rescue:</p>
<pre tabindex="0"><code>kelvin@monitor:/usr/local/zenoss/zenoss/etc$ grep admin \*
hubpasswd:admin:zenoss
</code></pre><p>Update: it is listed on page 4 of the Admin PDF :)</p>

  </div>

  
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="post-title entry-hint-parent">
      
      <a aria-label="post link to Install ESX from a USB (no CDROM)" href="http://localhost:1313/2008/12/install-esx-from-usb-no-cdrom_3723.html">Install ESX from a USB (no CDROM) </a>
      
      
    </h2>

    <div class="post-meta"><span title='2008-12-07 21:30:00.011 +1100 AEDT'>Published on December 7, 2008</span>&nbsp;·&nbsp;1 min

</div>
  </header>

  <div class="entry-content">
    <p>My little server doesn&rsquo;t have a cdrom, but I didn&rsquo;t want to actually run ESX from a USB (i.e. esx-on-a-stick). Here are my notes of configuring a flash disk to boot the ESX installer (so you can install it onto a local disk). For this demo, my USB is /dev/sdb</p>
<ol>
<li>
<p>Install the syslinux utils to your computer (apt-get install syslinux mboot)</p>
</li>
<li>
<p>Install the MBR</p>
</li>
</ol>
<pre tabindex="0"><code>sudo install-mbr /dev/sdb
</code></pre><ol start="3">
<li>
<p>Copy all the files from the ISO to your fat32 formated partition</p>
</li>
<li>
<p>Install syslinux</p>
</li>
</ol>
<pre tabindex="0"><code>sudo syslinux /dev/sdb1
</code></pre><ol start="5">
<li>Move isolinux.cfg to syslinux.cfg, and try booting. If it doesn&rsquo;t work, edit syslinux.cfg says something like:</li>
</ol>
<pre tabindex="0"><code>default menu.c32
menu title ESXi Boot
timeout 100

label ESXi
menu label Boot VMware ESXi
kernel mboot.c32
append vmkernel.gz --- binmod.tgz --- environ.tgz --- cim.tgz
ipappend 2
</code></pre><ol start="6">
<li>Unplug your USB, put it in your server, reboot, boot to USB-HDD (or select the USB disk), and install ESX to the local disk. You will likely be greeted with a sign saying &ldquo;MBR FA:&rdquo;, where you need to press &ldquo;A&rdquo; and then &ldquo;1&rdquo;.</li>
</ol>

  </div>

  
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="post-title entry-hint-parent">
      
      <a aria-label="post link to Using Django with SQL Server and IIS" href="http://localhost:1313/2008/11/using-django-with-sql-server-and-iis_4115.html">Using Django with SQL Server and IIS </a>
      
      
    </h2>

    <div class="post-meta"><span title='2008-11-08 21:30:00.002 +1100 AEDT'>Published on November 8, 2008</span>&nbsp;·&nbsp;3 min

</div>
  </header>

  <div class="entry-content">
    <p>As you can tell from reading some of the other pages, I like Linux and open source. But I also like to answer the question &ldquo;what if&hellip;&rdquo; This post is my [brief] run down of answering &ldquo;what if I could run Django on Server 2003 with SQL Server and IIS.&rdquo; Why, you may ask? To be honest with you, at this point, I don&rsquo;t really know. One of the deciding factors was seeing that the django-mssql project maintains support for inspectdb, which means I could take a stock 2003 server running SQL Server, inspect the DB, and build a web app on top of it. The Django docs offer a lengthy <a href="http://code.djangoproject.com/wiki/DjangoOnWindowsWithIISAndSQLServer">howto</a> for using Django with IIS and SQL Server, but the website for PyISAPIe seems to have been down for the last month or so. Without further delay, below are my notes on installing Django with SQL Server and IIS.</p>
<p>1a) Install python-2.x.x.msi from python.org</p>
<p>1b) Consider adding C:\Python25\ to your Path (right click My Computer, Advanced, Environment Variables. Enter in blahblahblah;C:\Python25\)</p>
<ol start="2">
<li>Download a 1.0+ branch of Django (and 7-zip if you need it)</li>
</ol>
<p>3a) Extract the contents of the Django. From inside Django-1.0, execute:</p>
<pre tabindex="0"><code>C:\\Python25\\python.exe setup.py install
</code></pre><p>3b) Consider adding C:\Python25\Script to your path.</p>
<ol start="4">
<li>
<p>Look in C:\Python25\Lib\site-packages &ndash; confirm there is a Django package.</p>
</li>
<li>
<p>Checkout django-mssql (<a href="http://code.google.com/p/django-mssql/)">http://code.google.com/p/django-mssql/)</a>, copy sqlserver_ado from inside source to the site-packages directory</p>
</li>
<li>
<p>Download and install PyWin32 from sf.net</p>
</li>
<li>
<p>Start a test project in C:\Inetpub\ called &rsquo;test'</p>
</li>
</ol>
<pre tabindex="0"><code>c:\\Python25\\scripts\\django-admin.py startproject test
</code></pre><p>8a) Create a database using SQL Management Studio, create a user. (First, go to the Security dropdown. Right click Logins, add a new user. Next, right click Databases, New Database. Enter in the name, and change the owner to the user you just created).</p>
<p>8b) Edit the settings.py and add &lsquo;sqlserver_ado&rsquo; and add database credentials. Use the below example if your database comes up in the Studio as COMPUTERNAME\SQLEXPRESS (you are using SQLExpress).</p>
<pre tabindex="0"><code>import os
DATABASE\_ENGINE = &#39;sqlserver\_ado&#39;           # &#39;postgresql\_psycopg2&#39;, &#39;postgresql&#39;, &#39;mysql&#39;, &#39;sqlite3&#39; or &#39;oracle&#39;.
DATABASE\_NAME = &#39;crmtest&#39;             # Or path to database file if using sqlite3.
DATABASE\_USER = &#39;crmtest&#39;             # Not used with sqlite3.
DATABASE\_PASSWORD = &#39;password&#39;         # Not used with sqlite3.
DATABASE\_MSSQL\_REGEX = True
DATABASE\_HOST =  os.environ\[&#39;COMPUTERNAME&#39;\] + r&#39;\\SQLEXPRESS&#39; # I use SQLEXPRESS
DATABASE\_PORT = &#39;&#39;             # Set to empty string for default. Not used with sqlite3.
</code></pre><ol start="9">
<li>Install/download FLUP: <a href="http://www.saddi.com/software/flup/dist/flup-1.0.1.tar.gz">http://www.saddi.com/software/flup/dist/flup-1.0.1.tar.gz</a></li>
</ol>
<pre tabindex="0"><code>python setup.py install
</code></pre><p>10a) Download pyisapi-scgi from <a href="http://code.google.com/p/pyisapi-scgi/">http://code.google.com/p/pyisapi-scgi/</a></p>
<p>10b) Extract the files to somewhere you can remember on your computer, like, c:\scgi</p>
<ol start="11">
<li>Double click pyisapi_scgi.py</li>
</ol>
<p>12a) Follow the directions here: <a href="http://code.google.com/p/pyisapi-scgi/wiki/howtoen">http://code.google.com/p/pyisapi-scgi/wiki/howtoen</a> &ndash; I set a temporary different port since I&rsquo;m just testing this out.</p>
<p>12b) The last few parts might be better served with an image or two:</p>
<h4 id="using-an-app-pool-to-get-the-right-permissions">Using an app pool to get the right permissions</h4>
<p>(No resource/photo)</p>
<h4 id="the-scgi-configuration-file">The SCGI configuration file</h4>
<p>(No resource/photo)</p>
<h4 id="properties-of-the-web-site">Properties of the web site</h4>
<p>(No resource/photo)<br>
13) Start the scgi process from the Django folder directory</p>
<pre tabindex="0"><code>python manage.py runfcgi method=threaded protocol=scgi port=3033 host=127.0.0.1
</code></pre><ol start="14">
<li>Test your django page, http://192.168.12.34:8080</li>
</ol>
<p>(No resource/photo)</p>

  </div>

  
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="post-title entry-hint-parent">
      
      <a aria-label="post link to Backup OpenFiler to S3" href="http://localhost:1313/2008/11/backup-openfiler-to-s3_9140.html">Backup OpenFiler to S3 </a>
      
      
    </h2>

    <div class="post-meta"><span title='2008-11-02 21:30:00.01 +1100 AEDT'>Published on November 2, 2008</span>&nbsp;·&nbsp;2 min

</div>
  </header>

  <div class="entry-content">
    <p>Backing up your Openfiler box to S3</p>
<p>While I don&rsquo;t think most pople would expect to backup their entire NAS/SAN to Amazon&rsquo;s S3, there might be a few very crucial things you need to backup. For instance, my girlfriend&rsquo;s PhD papers and data.</p>
<p>I&rsquo;ve seen an implementation using Ruby and s3sync &ndash; something that I do on my server &ndash; but I&rsquo;m trying to migrate everything to Python. Although there are a lot of great tools out there for S3, many of them Python-based, I wanted to do one thing and do it well: have one complete full backup available, and using as little bandwidth as possible. In these regards Duplicity would work well, except I wanted the ability to browse the S3 store using any other tool.</p>
<p>I&rsquo;ve digged deeper into <a href="http://s3tools.logix.cz/s3cmd">s3cmd</a>, which I had noticed a long time ago, but I failed to notice it has a sync option. I have tested it out, and it appears to work very, very well. Here&rsquo;s how to use it with OF.</p>
<p>First, download <a href="http://s3tools.logix.cz/download">s3cmd</a>. You&rsquo;ll need to use subversion, so I first checked it out to my laptop, then uploaded it via SSH to OF. I put my s3cmd folder in /opt.</p>
<pre tabindex="0"><code>  
\[root@files opt\]# ls  
openfiler  s3cmd  
\[root@files opt\]#   
</code></pre><p>If you don&rsquo;t have elementtree installed, now is a good time to install it.</p>
<pre tabindex="0"><code>  
conary update elementtree:python  
</code></pre><p>We need to next configure s3cmd with our AWS creds.</p>
<pre tabindex="0"><code>  
\[root@files s3cmd\]# ./s3cmd --configure  
</code></pre><p>In the end I didn&rsquo;t configure encryption for my files (so just hit enter), but you may choose to do so. I have configured the transfer to use HTTPS, however.</p>
<pre tabindex="0"><code>  
Save settings? \[y/N\] y  
Configuration saved to &#39;/root/.s3cfg&#39;  
</code></pre><p>Cool. Now create a bucket on S3 for your NAS, e.g. blah2134accesskey.openfiler, using whatever method you choose (I typically use Cockpit). Now that you have a bucket, configure a *really* simple script to drop in cron:</p>
<pre tabindex="0"><code>  
#!/bin/bash  
  
/opt/s3cmd/s3cmd sync /mnt/openfiler/data/profiles/bunny s3://blah2134accesskey.openfiler/mnt/openfiler/data/profiles/bunny  
/opt/s3cmd/s3cmd sync /mnt/openfiler/data/profiles/kelvin-pc s3://blah2134accesskey.openfiler/mnt/openfiler/data/profiles/knicholson/kelvin-pc  
</code></pre><p>Sweet! I like this approach quite a bit: I get file-level access to anything on the NAS, you don&rsquo;t have to actually install anything, and it &lsquo;just works.&rsquo;</p>

  </div>

  
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="post-title entry-hint-parent">
      
      <a aria-label="post link to Configure Timevault to Remote Server" href="http://localhost:1313/2008/11/configure-timevault-to-remote-server_2418.html">Configure Timevault to Remote Server </a>
      
      
    </h2>

    <div class="post-meta"><span title='2008-11-02 21:30:00.011 +1100 AEDT'>Published on November 2, 2008</span>&nbsp;·&nbsp;1 min

</div>
  </header>

  <div class="entry-content">
    <p>Using TimeVault with a shared drive as a backend is actually quite easy, but it does require a few special things setup. Note: this is gonna be a brief summary.</p>
<p>Install samba-tools, smbfs&hellip;</p>
<pre tabindex="0"><code>sudo apt-get install samba-tools smbfs
</code></pre><p>A lot more other stuff may install as well.</p>
<p>Create a script that mounts your samba share. You could also do this in fstab, but I tend to suspend my laptop when I come home, and I like clicking buttons.</p>
<pre tabindex="0"><code>#!/bin/bash

mount -t cifs //192.168.44.2/kelvin /mnt/backups -o netbiosname=KELVIN-PC,iocharset=utf8,credentials=/home/kelvin/Apps/.smb-details.txt
</code></pre><p>smb-details.txt includes:</p>
<pre tabindex="0"><code>username=DOMAIN\\kelvin
password=mypassword
</code></pre><p>Finally, create a folder called &rsquo;timevault&rsquo; or something inside your mapped share, then launch TimeVault and configure it to use the above mentioned /mnt/backups/timevault folder. Configure Timevault as normal.</p>

  </div>

  
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="post-title entry-hint-parent">
      
      <a aria-label="post link to PyGTK &#43; py2exe for Windows" href="http://localhost:1313/2008/11/pygtk-py2exe-for-windows_8282.html">PyGTK &#43; py2exe for Windows </a>
      
      
    </h2>

    <div class="post-meta"><span title='2008-11-02 21:30:00.009 +1100 AEDT'>Published on November 2, 2008</span>&nbsp;·&nbsp;1 min

</div>
  </header>

  <div class="entry-content">
    <p>I&rsquo;m writing down these quick notes so I can remember the steps for getting py2exe to work with GTK.</p>
<ul>
<li>Download the GTK+ runtime</li>
<li>Download py2exe</li>
<li>Copy over your project into the windows box</li>
<li>Create a setup.py file (see below)</li>
<li>Run &ldquo;c:\Python25\python.exe setup.py py2exe&rdquo;</li>
<li>Copy over the lib, etc, and share folder from C:\Program Files\GTK2-Runtime into the dist folder</li>
<li>Run app!</li>
</ul>
<p>setup.py:</p>
<pre tabindex="0"><code>from distutils.core import setup
import py2exe

setup(
name = &#39;ploteq&#39;,
description = &#39;Bunnys Plotting Tool&#39;,
version = &#39;1.0&#39;,

windows = \[
{
&#39;script&#39;: &#39;ploteq.py&#39;,
}
\],

options = {
&#39;py2exe&#39;: {
&#39;packages&#39;:&#39;encodings&#39;,
&#39;includes&#39;: &#39;cairo, pango, pangocairo, atk, gobject&#39;, 
}
},

data\_files=\[
&#39;ploteq.glade&#39;,
\]
)
</code></pre>
  </div>

  
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="post-title entry-hint-parent">
      
      <a aria-label="post link to Revised mod_tile Install HOWTO" href="http://localhost:1313/2008/11/revised-modtile-install-howto_1369.html">Revised mod_tile Install HOWTO </a>
      
      
    </h2>

    <div class="post-meta"><span title='2008-11-01 21:30:00.005 +1100 AEDT'>Published on November 1, 2008</span>&nbsp;·&nbsp;4 min

</div>
  </header>

  <div class="entry-content">
    <p>This is the laundry list of things I did while creating a mod_tile VMware appliance based on Ubuntu Server 8.04. I&rsquo;ve kept descriptions limited but left all the commands in. Let&rsquo;s start installing things&hellip;</p>
<p><strong>Useful goodies for compiling source</strong></p>
<pre tabindex="0"><code>sudo apt-get build-essential
</code></pre><p><strong>More goodies for Mapnik + Friends</strong></p>
<pre tabindex="0"><code>sudo apt-get install libboost-dev libboost-filesystem-dev libboost-filesystem1.34.1 libboost-iostreams-dev libboost-iostreams1.34.1 libboost-program-options-dev libboost-program-options1.34.1 libboost-python-dev libboost-python1.34.1 libboost-regex-dev libboost-regex1.34.1 libboost-serialization-dev libboost-serialization1.34.1 libboost-thread-dev libboost-thread1.34.1 libicu-dev libicu38 libstdc++5 libstdc++5-3.3-dev python2.5-dev
</code></pre><pre tabindex="0"><code>sudo aptitude install libfreetype6 libfreetype6-dev libjpeg62 libjpeg62-dev libltdl3 libltdl3-dev libpng12-0 libpng12-dev libtiff4 libtiff4-dev libtiffxx0c2 python-imaging python-imaging-dbg proj
</code></pre><pre tabindex="0"><code>sudo aptitude install libcairo2 libcairo2-dev python-cairo python-cairo-dev libcairomm-1.0-1 libcairomm-1.0-dev libglib2.0-0 libpixman-1-0 libpixman-1-dev libpthread-stubs0 libpthread-stubs0-dev ttf-dejavu ttf-dejavu-core ttf-dejavu-extra
</code></pre><pre tabindex="0"><code>sudo aptitude install libgdal-dev python2.5-gdal postgresql-8.3-postgis postgresql-8.3 postgresql-server-dev-8.3 postgresql-contrib-8.3
</code></pre><pre tabindex="0"><code>sudo aptitude install libxslt1.1 libxslt1-dev libxml2-dev libxml2 gdal-bin libgeos-dev libbz2-dev
</code></pre><pre tabindex="0"><code>sudo aptitude install apache2 apache2-threaded-dev apache2-mpm-prefork apache2-utils
</code></pre><pre tabindex="0"><code>sudo aptitude install subversion
</code></pre><p>This checks out the mapnik source:</p>
<pre tabindex="0"><code>svn co svn://svn.mapnik.org/trunk mapnik-src
</code></pre><p>Let&rsquo;s build mapnik with several specific locations included.</p>
<pre tabindex="0"><code>cd mapnik-src
python scons/scons.py PYTHON=/usr/bin/python PGSQL\_INCLUDES=/usr/include/postgresql PGSQL\_LIBS=/usr/lib/postgresql BOOST\_INCLUDES=/usr/include/boost BOOST\_LIBS=/usr/lib
</code></pre><pre tabindex="0"><code>sudo python scons/scons.py install PYTHON=/usr/bin/python PGSQL\_INCLUDES=/usr/include/postgresql PGSQL\_LIBS=/usr/lib/postgresql BOOST\_INCLUDES=/usr/include/boost BOOST\_LIBS=/usr/lib
</code></pre><p>And prepare a few things for the mapnik rendering&hellip;</p>
<pre tabindex="0"><code>svn co http://svn.openstreetmap.org/applications/rendering/mapnik/
</code></pre><pre tabindex="0"><code>cd ~/mapnik
wget http://tile.openstreetmap.org/world\_boundaries-spherical.tgz 
tar -xpjf world\_boundaries-spherical.tgz
unzip processed\_p.zip 
cp coastlines/\* world\_boundaries/ 
rmdir coastlines 
</code></pre><p>Time to setup postgres. I have the intentions of running renderd (the mod_tile rendering engine) under whatever user Apache is running as, so I&rsquo;ll setup postgres to allow the OSM user to authenticate via password. I&rsquo;m not a postgres expert, so if you see me doing something totally foolish, let me know.</p>
<pre tabindex="0"><code>sudo vi /etc/postgresql/8.3/main/pg\_hba.conf
</code></pre><p>And edit the authentication part as so:</p>
<pre tabindex="0"><code>\# Database administrative login by UNIX sockets
local   all         postgres                          ident sameuser
local   all         osm                               password sameuser
</code></pre><p>And now to actually configure postgres for the OSM data</p>
<pre tabindex="0"><code>sudo su postgres
createuser osm
createdb -E UTF8 -O osm gis
createlang plpgsql gis
psql -d gis -f /usr/share/postgresql-8.3-postgis/lwpostgis.sql
echo &#34;ALTER TABLE geometry\_columns OWNER TO osm; ALTER TABLE spatial\_ref\_sys OWNER TO osm;&#34;  | psql -d gis
echo &#34;alter user osm with password &#39;columbia&#39;;&#34; | psql
</code></pre><pre tabindex="0"><code>sudo /etc/init.d/postgresql-8.3 restart
</code></pre><p>Now, let&rsquo;s render a sample image. Edit set-mapnik-env by changing the DB to &lsquo;gis&rsquo;, the username to &lsquo;osm&rsquo;, and the password to &lsquo;columbia&rsquo;</p>
<pre tabindex="0"><code>cd mapnik
source ./set-mapnik-env
./customize-mapnik-map &gt;osm.xml
./generate\_image.py
</code></pre><p>If you get an error about it not finding a lib, make sure to do a&hellip;</p>
<pre tabindex="0"><code>sudo ldconfig
</code></pre><p>You should have an image called &lsquo;image.png&rsquo; in the mapnik directory, and it should look distinctly like the UK.</p>
<pre tabindex="0"><code>svn co http://svn.openstreetmap.org/applications/utils/export/osm2pgsql
cd osm2pgsql
make
</code></pre><p>Ok, that was easy. Let&rsquo;s load some data. I&rsquo;ve used a sample snippit from Sydney in /home/osm to illustrate this.</p>
<pre tabindex="0"><code>./osm2pgsql -W -d gis ../sydney.osm
</code></pre><p>Type in the password used for postgres (&lsquo;columbia&rsquo;)</p>
<p>I&rsquo;ll now check that the data is accessible by editing generate_image.py with the correct coords for Sydney.</p>
<pre tabindex="0"><code>ll = (150.29, -34.04, 151.25, -33.36)
</code></pre><p>Time to get mod_tile up and running.</p>
<pre tabindex="0"><code>sudo apt-get install libagg-dev
</code></pre><pre tabindex="0"><code>svn co http://svn.openstreetmap.org/applications/utils/mod\_tile
cd mod\_tile
</code></pre><p>Depending on the revision of mod_tile you are using, you are going to have to edit the source before compiling. The two files you need to read through are the Makefile and render_config.h. I change the apxs and apachectl locations to the correct place (lines 2, 13 and 14). Since I did it on a x86 image, I took out any references to lib54 (line 33). In render_config.h, I made the following changes:</p>
<p>Line 8</p>
<pre tabindex="0"><code>#define WWW\_ROOT &#34;/var/www&#34;
</code></pre><p>Line 23</p>
<pre tabindex="0"><code>#define OSM\_XML &#34;/home/osm/mapnik/osm.xml&#34;
</code></pre><p>Removed references to lib64 on lines 26 and 29.</p>
<pre tabindex="0"><code>make &amp;&amp; make install
</code></pre><p>Set it up as a module for apache by creating a file in /etc/apache/conf.d called &lsquo;mod_tile&rsquo; and putting in there:</p>
<pre tabindex="0"><code>LoadModule tile\_module /usr/lib/apache2/modules/mod\_tile.so
</code></pre><p>Created a folder called &lsquo;osm_tiles2&rsquo; and &lsquo;direct&rsquo; in /var/www, and make sure they are writable by whatever apache runs as (likely www-data). Restart apache.</p>
<p>From here, I created a file that automatically zooms in on the map I just created &ndash; you can check it out here. Start the renderd process as www-data, and browse to the sample file.</p>
<pre tabindex="0"><code>cd ~/mod\_tile
sudo su www-data
./renderd
</code></pre><p>By now you should have a working mod_tile/OSM setup. After a change and tune a few things on the Ubuntu image I&rsquo;ll make the VMware image available for download. I can&rsquo;t wait to do some OSM projects!</p>

  </div>

  
</article>
<footer class="page-footer">
  <nav class="pagination">
    <a class="prev" href="http://localhost:1313/tags/howtos/page/3/">
      «&nbsp;Prev&nbsp;
    </a>
    <a class="next" href="http://localhost:1313/tags/howtos/page/5/">Next&nbsp;&nbsp;»
    </a>
  </nav>
</footer>
    </main>

    </div>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/">Kelvin Nicholson</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
